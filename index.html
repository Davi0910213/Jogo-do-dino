<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Block Dash - Dino & Cacto com Pause e Ranking</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background-color: #222;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: 100vh;
    font-family: Arial, sans-serif;
  }
  #game {
    position: relative;
    width: 900px;
    height: 300px;
    background-color: #444;
    overflow: hidden;
    border: 2px solid #fff;
  }
  #player {
    position: absolute;
    bottom: 40px;
    left: 80px;
    width: 50px;
    height: 50px;
    z-index: 10;
  }
  #player svg {
    width: 100%;
    height: 100%;
    shape-rendering: crispEdges;
  }
  .obstacle {
    position: absolute;
    bottom: 40px;
    width: 50px;
    height: 50px;
    z-index: 10;
  }
  .obstacle svg {
    width: 100%;
    height: 100%;
    shape-rendering: crispEdges;
  }
  #score {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 24px;
    z-index: 20;
  }
  #ranking {
    position: absolute;
    top: 50px;
    left: 10px;
    color: white;
    font-size: 16px;
    background-color: rgba(0,0,0,0.6);
    padding: 10px;
    border-radius: 8px;
    max-width: 300px;
    display: none;
    z-index: 50;
  }
  #startButton, #pauseButton {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 15px 30px;
    font-size: 20px;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #0a0;
    color: white;
    z-index: 30;
  }
  #pauseButton {
    top: 15px;
    left: auto;
    right: 15px;
    transform: none;
    display: none;
    background-color: #cc0000;
  }
</style>
</head>
<body>

<div id="game">
  <div id="score">Score: 0</div>
  <div id="ranking"></div>
  
  <div id="player">
    <!-- Dinossauro pixel art -->
    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges">
      <!-- Corpo -->
      <rect x="15" y="25" width="30" height="20" fill="#4CAF50" />
      <!-- Cabeça -->
      <rect x="10" y="20" width="10" height="15" fill="#4CAF50" />
      <!-- Olho -->
      <rect x="16" y="23" width="3" height="3" fill="#000" />
      <!-- Perna traseira -->
      <rect x="20" y="45" width="8" height="10" fill="#388E3C" />
      <!-- Perna dianteira -->
      <rect x="35" y="45" width="8" height="10" fill="#388E3C" />
      <!-- Cauda -->
      <rect x="45" y="30" width="10" height="5" fill="#4CAF50" />
      <rect x="55" y="25" width="5" height="5" fill="#4CAF50" />
    </svg>
  </div>

  <!-- Obstáculos dinâmicos -->
  <div id="obstacles">
    <!-- Obstáculos serão gerados aqui pelo JavaScript -->
  </div>

  <button id="startButton">Começar Jogo</button>
  <button id="pauseButton">Pausar</button>
</div>

<script>
  const player = document.getElementById('player');
  const obstaclesContainer = document.getElementById('obstacles');
  const scoreDisplay = document.getElementById('score');
  const startButton = document.getElementById('startButton');
  const pauseButton = document.getElementById('pauseButton');
  const rankingDisplay = document.getElementById('ranking');

  const gameWidth = 900;
  const groundLevel = 40;
  const playerLeft = 80;
  const playerWidth = 50;
  const playerHeight = 50;
  const obstacleWidth = 50;
  const obstacleHeight = 50;

  const playerHitbox = { width: 35, height: 40 };
  const obstacleHitbox = { width: 30, height: 40 };

  let isJumping = false;
  let jumpHeight = 0;
  let jumpSpeed = 0;
  const gravity = 0.7;

  let obstacleSpeed = 10;
  let obstacles = [];
  let score = 0;
  let gameOver = false;
  let gameStarted = false;
  let paused = false;
  let animationFrameId;

  // Função para gerar novos obstáculos
  function createObstacle() {
    const obstacle = document.createElement('div');
    obstacle.classList.add('obstacle');
    obstacle.style.left = gameWidth + 'px';
    obstaclesContainer.appendChild(obstacle);

    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('viewBox', '0 0 64 64');
    svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
    svg.setAttribute('shape-rendering', 'crispEdges');

    // Desenho do cacto
    const base = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    base.setAttribute('x', 20);
    base.setAttribute('y', 35);
    base.setAttribute('width', 24);
    base.setAttribute('height', 15);
    base.setAttribute('fill', '#D32F2F');
    svg.appendChild(base);

    const trunk = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    trunk.setAttribute('x', 28);
    trunk.setAttribute('y', 15);
    trunk.setAttribute('width', 8);
    trunk.setAttribute('height', 20);
    trunk.setAttribute('fill', '#D32F2F');
    svg.appendChild(trunk);

    obstacle.appendChild(svg);

    return obstacle;
  }

  function jump() {
    if (!isJumping && !paused) {
      isJumping = true;
      jumpSpeed = 12;
    }
  }

  function keyHandler(e) {
    if (!gameStarted || paused) return;
    if ((e.code === 'ArrowUp' || e.key.toLowerCase() === 'w') && !gameOver) {
      jump();
    }
  }

  startButton.addEventListener('click', () => {
    gameStarted = true;
    startButton.style.display = 'none';
    pauseButton.style.display = 'block';
    rankingDisplay.style.display = 'none';
    obstacles.forEach(ob => ob.remove());
    obstacles = [];
    score = 0;
    obstacleSpeed = 4;
    gameOver = false;
    jumpHeight = 0;
    isJumping = false;
    scoreDisplay.textContent = 'Score: 0';
    window.addEventListener('keydown', keyHandler);
    update();
  });

  pauseButton.addEventListener('click', () => {
    if (!paused) {
      paused = true;
      pauseButton.textContent = 'Retomar';
      if (animationFrameId) cancelAnimationFrame(animationFrameId);
    } else {
      paused = false;
      pauseButton.textContent = 'Pausar';
      update();
    }
  });

  // Função para salvar o score e atualizar ranking no localStorage
  function saveScore(score) {
    let ranking = JSON.parse(localStorage.getItem('blockDashRanking')) || [];
    ranking.push(score);
    ranking.sort((a, b) => b - a);
    if (ranking.length > 5) ranking = ranking.slice(0, 5);
    localStorage.setItem('blockDashRanking', JSON.stringify(ranking));
    return ranking;
  }

  // Exibir ranking na tela
  function showRanking(ranking) {
    rankingDisplay.style.display = 'block';
    rankingDisplay.innerHTML = '<strong>Top 5 Scores:</strong><br>';
    ranking.forEach((sc, i) => {
      rankingDisplay.innerHTML += `${i + 1}. ${sc}<br>`;
    });
  }

  function update() {
    if (gameOver || !gameStarted || paused) return;

    if (isJumping) {
      jumpHeight += jumpSpeed;
      jumpSpeed -= gravity;

      if (jumpHeight <= 0) {
        jumpHeight = 0;
        isJumping = false;
      }
    }

    player.style.bottom = groundLevel + jumpHeight + 'px';

    obstacles.forEach((obstacle, index) => {
      let pos = parseInt(obstacle.style.left) - obstacleSpeed;
      if (pos < -obstacleWidth) {
        obstacle.style.left = gameWidth + 'px';
        score++;
        scoreDisplay.textContent = 'Score: ' + score;

        // Velocidade não aumenta para manter mais lento
        // if (score % 3 === 0) {  
        //   obstacleSpeed += 1;
        // }
      } else {
        obstacle.style.left = pos + 'px';
      }

      // Verifica colisão
      const playerHitboxX = playerLeft + (playerWidth - playerHitbox.width) / 2;
      const playerHitboxY = groundLevel + jumpHeight;
      const obstacleHitboxX = parseInt(obstacle.style.left) + (obstacleWidth - obstacleHitbox.width) / 2;
      const obstacleHitboxY = groundLevel;

      const horizontalOverlap =
        playerHitboxX < obstacleHitboxX + obstacleHitbox.width &&
        playerHitboxX + playerHitbox.width > obstacleHitboxX;

      const verticalOverlap =
        playerHitboxY < obstacleHitboxY + obstacleHitbox.height &&
        playerHitboxY + playerHitbox.height > obstacleHitboxY;

      if (horizontalOverlap && verticalOverlap) {
        gameOver = true;

        // Salvar e mostrar ranking
        const ranking = saveScore(score);
        showRanking(ranking);

        alert('Game Over! Seu score: ' + score);
        pauseButton.style.display = 'none';
        startButton.style.display = 'block';
        return;
      }
    });

    // Adiciona obstáculos novos a cada 10 pontos, até 5 obstáculos
    if (score % 10 === 0 && obstacles.length < 5) {
      obstacles.push(createObstacle());
    }

    animationFrameId = requestAnimationFrame(update);
  }

  // Mostrar ranking armazenado ao carregar a página
  window.onload = () => {
    const ranking = JSON.parse(localStorage.getItem('blockDashRanking')) || [];
    if (ranking.length > 0) {
      showRanking(ranking);
    }
  }
</script>

</body>
</html>
